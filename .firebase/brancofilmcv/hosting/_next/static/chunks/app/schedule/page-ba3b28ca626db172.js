(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{6188:function(e,t,a){Promise.resolve().then(a.bind(a,5066))},5066:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(7437),l=a(2265),r=a(1221),n=a(7484),i=a(9501),d=a(5701),o=a(7119),c=a(2869),u=a(5186),m=a(6815),x=a(6818),f=a(3647),h=a(6070),g=a(5613),p=a(1817),j=a(1731);let v=o.Ry({title:o.Z_().min(1,"T\xedtulo \xe9 obrigat\xf3rio"),start:o.Z_().min(1,"Data/hora de in\xedcio \xe9 obrigat\xf3ria"),end:o.Z_().min(1,"Data/hora de fim \xe9 obrigat\xf3ria"),installerId:o.Z_().optional(),orderId:o.Z_().optional(),notes:o.Z_().optional()});function y(e){let{schedule:t,onSubmit:a,onCancel:r,loading:n=!1}=e,[o,y]=(0,l.useState)([]),[b,w]=(0,l.useState)([]),[N,D]=(0,l.useState)(!0),{register:k,handleSubmit:S,watch:I,setValue:Z,formState:{errors:_}}=(0,i.cI)({resolver:(0,d.F)(v),defaultValues:{title:(null==t?void 0:t.title)||"",start:(null==t?void 0:t.start)?new Date(t.start.toDate()).toISOString().slice(0,16):"",end:(null==t?void 0:t.end)?new Date(t.end.toDate()).toISOString().slice(0,16):"",installerId:(null==t?void 0:t.installerId)||"defaultInstallerId",orderId:(null==t?void 0:t.orderId)||"defaultOrderId",notes:(null==t?void 0:t.notes)||""}});(0,l.useEffect)(()=>{z()},[]);let z=async()=>{try{D(!0);let[e,t]=await Promise.all([j.Sr.getAll(),j.el.getInstallers()]);y(e.filter(e=>"concluida"!==e.status&&"cancelada"!==e.status)),w(t)}catch(e){console.error("Error loading data:",e)}finally{D(!1)}},C=async e=>{try{await a(e)}catch(e){console.error("Error submitting form:",e)}};return N?(0,s.jsx)(h.Zb,{className:"w-full max-w-2xl mx-auto",children:(0,s.jsx)(h.aY,{className:"flex items-center justify-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):(0,s.jsxs)(h.Zb,{className:"w-full max-w-2xl mx-auto",children:[(0,s.jsxs)(h.Ol,{children:[(0,s.jsx)(h.ll,{children:t?"Editar Agendamento":"Novo Agendamento"}),(0,s.jsx)(h.SZ,{children:t?"Atualize as informa\xe7\xf5es do agendamento":"Preencha os dados do novo agendamento"})]}),(0,s.jsx)(h.aY,{children:(0,s.jsxs)("form",{onSubmit:S(C),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"title",children:"T\xedtulo *"}),(0,s.jsx)(u.I,{id:"title",...k("title"),disabled:n,placeholder:"Ex: Instala\xe7\xe3o insufilm - Jo\xe3o Silva"}),_.title&&(0,s.jsx)(g.bZ,{variant:"destructive",children:(0,s.jsx)(g.X,{children:_.title.message})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"start",children:"Data/Hora In\xedcio *"}),(0,s.jsx)(u.I,{id:"start",type:"datetime-local",...k("start"),disabled:n}),_.start&&(0,s.jsx)(g.bZ,{variant:"destructive",children:(0,s.jsx)(g.X,{children:_.start.message})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"end",children:"Data/Hora Fim *"}),(0,s.jsx)(u.I,{id:"end",type:"datetime-local",...k("end"),disabled:n}),_.end&&(0,s.jsx)(g.bZ,{variant:"destructive",children:(0,s.jsx)(g.X,{children:_.end.message})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"installerId",children:"Instalador"}),(0,s.jsxs)(f.Ph,{value:I("installerId"),onValueChange:e=>Z("installerId",e),children:[(0,s.jsx)(f.i4,{children:(0,s.jsx)(f.ki,{placeholder:"Selecione um instalador"})}),(0,s.jsxs)(f.Bw,{children:[(0,s.jsx)(f.Ql,{value:"defaultInstallerId",children:"Nenhum instalador"}),b.map(e=>(0,s.jsx)(f.Ql,{value:e.uid,children:e.name||e.email},e.uid))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"orderId",children:"Ordem de Servi\xe7o"}),(0,s.jsxs)(f.Ph,{value:I("orderId"),onValueChange:e=>Z("orderId",e),children:[(0,s.jsx)(f.i4,{children:(0,s.jsx)(f.ki,{placeholder:"Selecione uma OS"})}),(0,s.jsxs)(f.Bw,{children:[(0,s.jsx)(f.Ql,{value:"defaultOrderId",children:"Nenhuma OS"}),o.map(e=>(0,s.jsxs)(f.Ql,{value:e.id,children:["#",e.id.slice(-6)," - ",e.status]},e.id))]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(m._,{htmlFor:"notes",children:"Observa\xe7\xf5es"}),(0,s.jsx)(x.g,{id:"notes",...k("notes"),disabled:n,placeholder:"Informa\xe7\xf5es adicionais sobre o agendamento...",rows:3})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,s.jsx)(c.z,{type:"button",variant:"outline",onClick:r,disabled:n,children:"Cancelar"}),(0,s.jsxs)(c.z,{type:"submit",disabled:n,children:[n&&(0,s.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Atualizar":"Criar"," Agendamento"]})]})]})})]})}var b=a(6110),w=a(7099),N=a(9397),D=a(1047),k=a(1723);let S=(0,a(9205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var I=a(2451),Z=a(407),_=a(2102),z=a(5153);function C(){let{user:e}=(0,_.a)(),[t,a]=(0,l.useState)([]),[i,d]=(0,l.useState)([]),[o,u]=(0,l.useState)(!0),[m,x]=(0,l.useState)(null),[f,g]=(0,l.useState)(!1),[p,v]=(0,l.useState)(!1),[C,E]=(0,l.useState)(null),[O,A]=(0,l.useState)(!1),[R,B]=(0,l.useState)(new Date),[F,T]=(0,l.useState)("week"),{toast:L}=(0,z.pm)();(0,l.useEffect)(()=>{Y()},[R,e]);let Y=async()=>{try{let t,s;if(u(!0),"day"===F)(t=new Date(R)).setHours(0,0,0,0),(s=new Date(R)).setHours(23,59,59,999);else if("week"===F){let e=new Date(R);e.setDate(R.getDate()-R.getDay()),e.setHours(0,0,0,0);let a=new Date(e);a.setDate(e.getDate()+6),a.setHours(23,59,59,999),t=e,s=a}else t=new Date(R.getFullYear(),R.getMonth(),1),s=new Date(R.getFullYear(),R.getMonth()+1,0,23,59,59,999);let[l,r]=await Promise.all([(null==e?void 0:e.role)==="instalador"?j.BJ.getByInstaller(e.uid):j.BJ.getByDateRange(t,s),j.el.getAll()]);a(l),d(r)}catch(e){console.error("Error loading data:",e),L({title:"Erro",description:"Erro ao carregar agendamentos",variant:"destructive"})}finally{u(!1)}},P=async e=>{try{A(!0),m?(await j.BJ.update(m.id,e),L({title:"Sucesso",description:"Agendamento atualizado com sucesso"})):(await j.BJ.create(e),L({title:"Sucesso",description:"Agendamento criado com sucesso"})),await Y(),g(!1),x(null)}catch(e){console.error("Error saving schedule:",e),L({title:"Erro",description:"Erro ao salvar agendamento",variant:"destructive"})}finally{A(!1)}},V=async()=>{if(C)try{await j.BJ.delete(C.id),L({title:"Sucesso",description:"Agendamento exclu\xeddo com sucesso"}),await Y()}catch(e){console.error("Error deleting schedule:",e),L({title:"Erro",description:"Erro ao excluir agendamento",variant:"destructive"})}finally{v(!1),E(null)}},H=e=>{let t=i.find(t=>t.uid===e);return(null==t?void 0:t.name)||(null==t?void 0:t.email)||"Usu\xe1rio n\xe3o encontrado"},J=e=>{let t=new Date(R);"day"===F?t.setDate(R.getDate()+("next"===e?1:-1)):"week"===F?t.setDate(R.getDate()+("next"===e?7:-7)):t.setMonth(R.getMonth()+("next"===e?1:-1)),B(t)},M=t.filter(e=>{let t=e.start.toDate(),a=new Date;return t.toDateString()===a.toDateString()}),Q=(null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="atendente";return(0,s.jsx)(r.L,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Agenda"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Visualize e gerencie agendamentos"})]}),Q&&(0,s.jsxs)(c.z,{onClick:()=>g(!0),children:[(0,s.jsx)(N.Z,{className:"h-4 w-4 mr-2"}),"Novo Agendamento"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)(h.Zb,{children:[(0,s.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(h.ll,{className:"text-sm font-medium",children:"Agendamentos Hoje"}),(0,s.jsx)(D.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:M.length})})]}),(0,s.jsxs)(h.Zb,{children:[(0,s.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(h.ll,{className:"text-sm font-medium",children:"Total no Per\xedodo"}),(0,s.jsx)(k.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:t.length})})]}),(0,s.jsxs)(h.Zb,{children:[(0,s.jsxs)(h.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(h.ll,{className:"text-sm font-medium",children:"Com OS Vinculada"}),(0,s.jsx)(S,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(h.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:t.filter(e=>e.orderId).length})})]})]}),(0,s.jsx)(h.Zb,{children:(0,s.jsx)(h.Ol,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>J("prev"),children:(0,s.jsx)(I.Z,{className:"h-4 w-4"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:(()=>{if("day"===F)return R.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if("week"!==F)return R.toLocaleDateString("pt-BR",{year:"numeric",month:"long"});{let e=new Date(R);e.setDate(R.getDate()-R.getDay());let t=new Date(e);return t.setDate(e.getDate()+6),"".concat(e.toLocaleDateString("pt-BR")," - ").concat(t.toLocaleDateString("pt-BR"))}})()}),(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>J("next"),children:(0,s.jsx)(Z.Z,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(c.z,{variant:"day"===F?"default":"outline",size:"sm",onClick:()=>T("day"),children:"Dia"}),(0,s.jsx)(c.z,{variant:"week"===F?"default":"outline",size:"sm",onClick:()=>T("week"),children:"Semana"}),(0,s.jsx)(c.z,{variant:"month"===F?"default":"outline",size:"sm",onClick:()=>T("month"),children:"M\xeas"})]})]})})}),(0,s.jsx)(n.w,{data:t,columns:[{key:"title",title:"T\xedtulo",sortable:!0},{key:"start",title:"In\xedcio",render:e=>(null==e?void 0:e.toDate)?e.toDate().toLocaleString("pt-BR"):"-"},{key:"end",title:"Fim",render:e=>(null==e?void 0:e.toDate)?e.toDate().toLocaleString("pt-BR"):"-"},{key:"installer",title:"Instalador",render:(e,t)=>t.installerId?H(t.installerId):"N\xe3o atribu\xeddo"},{key:"orderId",title:"OS",render:e=>e?"#".concat(e.slice(-6)):"-"},{key:"notes",title:"Observa\xe7\xf5es",render:e=>e||"-"}],title:"Lista de Agendamentos",description:"Agendamentos do per\xedodo selecionado",searchPlaceholder:"Buscar por t\xedtulo, instalador ou observa\xe7\xf5es...",onAdd:Q?()=>g(!0):void 0,onEdit:Q?e=>{x(e),g(!0)}:void 0,onDelete:Q?e=>{E(e),v(!0)}:void 0,loading:o,addButtonText:"Novo Agendamento"}),(0,s.jsx)(b.Vq,{open:f,onOpenChange:g,children:(0,s.jsx)(b.cZ,{className:"max-w-2xl",children:(0,s.jsx)(y,{schedule:m||void 0,onSubmit:P,onCancel:()=>{g(!1),x(null)},loading:O})})}),(0,s.jsx)(w.aR,{open:p,onOpenChange:v,children:(0,s.jsxs)(w._T,{children:[(0,s.jsxs)(w.fY,{children:[(0,s.jsx)(w.f$,{children:"Confirmar Exclus\xe3o"}),(0,s.jsx)(w.yT,{children:"Tem certeza que deseja excluir este agendamento? Esta a\xe7\xe3o n\xe3o pode ser desfeita."})]}),(0,s.jsxs)(w.xo,{children:[(0,s.jsx)(w.le,{children:"Cancelar"}),(0,s.jsx)(w.OL,{onClick:V,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})})]})})}},5613:function(e,t,a){"use strict";a.d(t,{X:function(){return o},bZ:function(){return d}});var s=a(7437),l=a(2265),r=a(535),n=a(4508);let i=(0,r.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=l.forwardRef((e,t)=>{let{className:a,variant:l,...r}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(i({variant:l}),a),...r})});d.displayName="Alert",l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...l})}).displayName="AlertTitle";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...l})});o.displayName="AlertDescription"},3647:function(e,t,a){"use strict";a.d(t,{Bw:function(){return h},Ph:function(){return c},Ql:function(){return g},i4:function(){return m},ki:function(){return u}});var s=a(7437),l=a(2265),r=a(8856),n=a(875),i=a(2135),d=a(401),o=a(4508);let c=r.fC;r.ZA;let u=r.B4,m=l.forwardRef((e,t)=>{let{className:a,children:l,...i}=e;return(0,s.jsxs)(r.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[l,(0,s.jsx)(r.JO,{asChild:!0,children:(0,s.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.xz.displayName;let x=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.u_,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})});x.displayName=r.u_.displayName;let f=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.$G,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...l,children:(0,s.jsx)(n.Z,{className:"h-4 w-4"})})});f.displayName=r.$G.displayName;let h=l.forwardRef((e,t)=>{let{className:a,children:l,position:n="popper",...i}=e;return(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,s.jsx)(x,{}),(0,s.jsx)(r.l_,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,s.jsx)(f,{})]})})});h.displayName=r.VY.displayName,l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...l})}).displayName=r.__.displayName;let g=l.forwardRef((e,t)=>{let{className:a,children:l,...n}=e;return(0,s.jsxs)(r.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.wU,{children:(0,s.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(r.eT,{children:l})]})});g.displayName=r.ck.displayName,l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...l})}).displayName=r.Z0.displayName},6818:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var s=a(7437),l=a(2265),r=a(4508);let n=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...l})});n.displayName="Textarea"},1723:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},1817:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[609,15,365,852,905,593,289,641,302,971,117,744],function(){return e(e.s=6188)}),_N_E=e.O()}]);